
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Getting started with cloudknot &#8212; cloudknot 0.1 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/collapsible.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Documentation" href="documentation.html" />
    <link rel="prev" title="Welcome to cloudknot" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">cloudknot</a></h1>



<p class="blurb">Run your existing python code on AWS Batch</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=richford&repo=cloudknot&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#obtaining-an-aws-account">Obtaining an AWS account</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation-and-configuration">Installation and configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#permissions">Permissions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-multiple-aws-profiles">Using multiple AWS profiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="#region-shopping">Region shopping</a></li>
<li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cloudknot-s3-bucket">Cloudknot S3 Bucket</a></li>
<li class="toctree-l2"><a class="reference internal" href="#aws-resource-limitations">AWS resource limitations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#debugging-and-logging">Debugging and logging</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="documentation.html">documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">faq</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/richford/cloudknot/tree/master/examples">examples</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/richford/cloudknot">code</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/richford/cloudknot/issues">bugs</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="getting-started-with-cloudknot">
<span id="getting-started-label"></span><h1>Getting started with cloudknot<a class="headerlink" href="#getting-started-with-cloudknot" title="Permalink to this headline">¶</a></h1>
<p>To get started with cloudknot you will need an AWS account with the proper
permisssions and you will need to install cloudknot.</p>
<div class="section" id="obtaining-an-aws-account">
<h2>Obtaining an AWS account<a class="headerlink" href="#obtaining-an-aws-account" title="Permalink to this headline">¶</a></h2>
<p>If you haven’t already done so, create an <a class="reference external" href="https://aws.amazon.com">Amazon Web Services (AWS)</a> account.</p>
</div>
<div class="section" id="installation-and-configuration">
<h2>Installation and configuration<a class="headerlink" href="#installation-and-configuration" title="Permalink to this headline">¶</a></h2>
<p>You can install cloudknot from PyPI (recommended):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">cloudknot</span>
</pre></div>
</div>
<p>or from the <a class="reference external" href="https://github.com/richford/cloudknot">github repository</a>.
This will install cloudknot and its python dependencies. You must also
<a class="reference external" href="https://docs.docker.com/engine/installation/">install Docker</a> and start
the Docker daemon for cloudknot to work properly.</p>
<p>After installation, you must configure cloudknot by running:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cloudknot</span> <span class="n">configure</span>
</pre></div>
</div>
<p>This runs the AWS-CLI configuration tool and also installs some cloudknot
infrastructure on AWS. Follow the prompts or simply press &lt;ENTER&gt; to accept
the default values.</p>
</div>
<div class="section" id="permissions">
<h2>Permissions<a class="headerlink" href="#permissions" title="Permalink to this headline">¶</a></h2>
<p>To use cloudknot, you must have the same permissions required to use AWS
Batch. You can attach a managed policy, such as <a class="reference external" href="https://docs.aws.amazon.com/batch/latest/userguide/batch_managed_policies.html">AWSBatchFullAccess</a>
or <a class="reference external" href="https://docs.aws.amazon.com/batch/latest/userguide/batch_IAM_user_policies.html">AWSBatchUserPolicy</a>.
If you prefer to write your own policies, the minimal permissions required
for a cloudknot user should be contained in the following policy summary:</p>
<div class="toggle docutils container">
<div class="header docutils container">
<strong>policy summary</strong></div>
<div class="content docutils container">
<div class="highlight-none"><div class="highlight"><pre><span></span>{
    &quot;Version&quot;: &quot;2012-10-17&quot;,
    &quot;Statement&quot;: [
        {
            &quot;Sid&quot;: &quot;Stmt1506474362000&quot;,
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: [
                &quot;iam:AddRoleToInstanceProfile&quot;,
                &quot;iam:AttachRolePolicy&quot;,
                &quot;iam:CreateInstanceProfile&quot;,
                &quot;iam:CreatePolicy&quot;,
                &quot;iam:CreatePolicyVersion&quot;,
                &quot;iam:CreateRole&quot;,
                &quot;iam:DeleteInstanceProfile&quot;,
                &quot;iam:DeletePolicyVersion&quot;,
                &quot;iam:DeleteRole&quot;,
                &quot;iam:DetachRolePolicy&quot;,
                &quot;iam:GetRole&quot;,
                &quot;iam:ListAttachedRolePolicies&quot;,
                &quot;iam:ListEntitiesForPolicy&quot;,
                &quot;iam:ListInstanceProfilesForRole&quot;,
                &quot;iam:ListPolicies&quot;,
                &quot;iam:ListPolicyVersions&quot;,
                &quot;iam:ListRoles&quot;,
                &quot;iam:PassRole&quot;,
                &quot;iam:RemoveRoleFromInstanceProfile&quot;,
                &quot;iam:GetInstanceProfile&quot;,
                &quot;sts:AssumeRole&quot;
            ],
            &quot;Resource&quot;: [
                &quot;*&quot;
            ]
        },
        {
            &quot;Sid&quot;: &quot;Stmt1506474653000&quot;,
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: [
                &quot;ec2:AssociateDhcpOptions&quot;,
                &quot;ec2:AssociateRouteTable&quot;,
                &quot;ec2:AttachInternetGateway&quot;,
                &quot;ec2:AuthorizeSecurityGroupEgress&quot;,
                &quot;ec2:AuthorizeSecurityGroupIngress&quot;,
                &quot;ec2:CreateDhcpOptions&quot;,
                &quot;ec2:CreateInternetGateway&quot;,
                &quot;ec2:CreateNatGateway&quot;,
                &quot;ec2:CreateNetworkAcl&quot;,
                &quot;ec2:CreateNetworkAclEntry&quot;,
                &quot;ec2:CreateNetworkInterface&quot;,
                &quot;ec2:CreateNetworkInterfacePermission&quot;,
                &quot;ec2:CreateRoute&quot;,
                &quot;ec2:CreateRouteTable&quot;,
                &quot;ec2:CreateSecurityGroup&quot;,
                &quot;ec2:CreateSubnet&quot;,
                &quot;ec2:CreateTags&quot;,
                &quot;ec2:CreateVpc&quot;,
                &quot;ec2:CreateVpcEndpoint&quot;,
                &quot;ec2:CreateVpcPeeringConnection&quot;,
                &quot;ec2:CreateVpnConnection&quot;,
                &quot;ec2:CreateVpnConnectionRoute&quot;,
                &quot;ec2:CreateVpnGateway&quot;,
                &quot;ec2:DeleteInternetGateway&quot;,
                &quot;ec2:DeleteNetworkAcl&quot;,
                &quot;ec2:DeleteRouteTable&quot;,
                &quot;ec2:DeleteSecurityGroup&quot;,
                &quot;ec2:DeleteSubnet&quot;,
                &quot;ec2:DeleteVpc&quot;,
                &quot;ec2:DescribeAvailabilityZones&quot;,
                &quot;ec2:DescribeInstances&quot;,
                &quot;ec2:DescribeInternetGateways&quot;,
                &quot;ec2:DescribeNetworkAcls&quot;,
                &quot;ec2:DescribeRegions&quot;,
                &quot;ec2:DescribeRouteTables&quot;,
                &quot;ec2:DescribeSecurityGroups&quot;,
                &quot;ec2:DescribeSubnets&quot;,
                &quot;ec2:DescribeTags&quot;,
                &quot;ec2:DescribeVpcs&quot;,
                &quot;ec2:DetachInternetGateway&quot;,
                &quot;ec2:ModifySubnetAttribute&quot;,
                &quot;ec2:TerminateInstances&quot;
            ],
            &quot;Resource&quot;: [
                &quot;*&quot;
            ]
        },
        {
            &quot;Sid&quot;: &quot;Stmt1506474963000&quot;,
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: [
                &quot;batch:CancelJob&quot;,
                &quot;batch:CreateComputeEnvironment&quot;,
                &quot;batch:CreateJobQueue&quot;,
                &quot;batch:DeleteComputeEnvironment&quot;,
                &quot;batch:DeleteJobQueue&quot;,
                &quot;batch:DeregisterJobDefinition&quot;,
                &quot;batch:DescribeComputeEnvironments&quot;,
                &quot;batch:DescribeJobDefinitions&quot;,
                &quot;batch:DescribeJobQueues&quot;,
                &quot;batch:DescribeJobs&quot;,
                &quot;batch:ListJobs&quot;,
                &quot;batch:RegisterJobDefinition&quot;,
                &quot;batch:SubmitJob&quot;,
                &quot;batch:TerminateJob&quot;,
                &quot;batch:UpdateComputeEnvironment&quot;,
                &quot;batch:UpdateJobQueue&quot;
            ],
            &quot;Resource&quot;: [
                &quot;*&quot;
            ]
        },
        {
            &quot;Sid&quot;: &quot;Stmt1506475112000&quot;,
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: [
                &quot;ecr:BatchDeleteImage&quot;,
                &quot;ecr:CreateRepository&quot;,
                &quot;ecr:DescribeRepositories&quot;,
                &quot;ecr:DescribeImages&quot;,
                &quot;ecr:GetAuthorizationToken&quot;,
                &quot;ecr:InitiateLayerUpload&quot;,
                &quot;ecr:UploadLayerPart&quot;,
                &quot;ecr:CompleteLayerUpload&quot;,
                &quot;ecr:BatchCheckLayerAvailability&quot;,
                &quot;ecr:BatchDeleteImage&quot;,
                &quot;ecr:PutImage&quot;,
                &quot;ecr:DeleteRepository&quot;
            ],
            &quot;Resource&quot;: [
                &quot;*&quot;
            ]
        },
        {
            &quot;Sid&quot;: &quot;Stmt1508984153000&quot;,
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: [
                &quot;ecs:DeleteCluster&quot;,
                &quot;ecs:DeregisterContainerInstance&quot;,
                &quot;ecs:ListContainerInstances&quot;
            ],
            &quot;Resource&quot;: [
                &quot;*&quot;
            ]
        },
        {
            &quot;Sid&quot;: &quot;Stmt1509807738000&quot;,
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: [
                &quot;s3:CreateBucket&quot;,
                &quot;s3:GetObject&quot;,
                &quot;s3:ListBucket&quot;,
                &quot;s3:PutObject&quot;
            ],
            &quot;Resource&quot;: [
                &quot;*&quot;
            ]
        }
    ]
}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="using-multiple-aws-profiles">
<h2>Using multiple AWS profiles<a class="headerlink" href="#using-multiple-aws-profiles" title="Permalink to this headline">¶</a></h2>
<p>If you want to use cloudknot with multiple AWS profiles, make sure that you
have the profiles configured in the AWS credentials file, e.g.:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span># ~/.aws/credentials

[default]
AWS_ACCESS_KEY_ID=AK******************
AWS_SECRET_ACCESS_KEY=****************************************

[another-profile-i-use]
AWS_ACCESS_KEY_ID=AK******************
AWS_SECRET_ACCESS_KEY=****************************************

[project-specific-profile]
AWS_ACCESS_KEY_ID=AK******************
AWS_SECRET_ACCESS_KEY=****************************************

[profile-with-another-organization]
AWS_ACCESS_KEY_ID=AK*******************
AWS_SECRET_ACCESS_KEY=****************************************
</pre></div>
</div>
<p>or in the AWS config file, e.g.:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span># ~/.aws/config

[default]
region=us-east-1
output=json

[profile default]
AWS_ACCESS_KEY_ID=AK******************
AWS_SECRET_ACCESS_KEY=****************************************

[profile another-profile-i-use]
AWS_ACCESS_KEY_ID=AK******************
AWS_SECRET_ACCESS_KEY=****************************************

[profile project-specific-profile]
AWS_ACCESS_KEY_ID=AK******************
AWS_SECRET_ACCESS_KEY=****************************************

[profile profile-with-another-organization]
AWS_ACCESS_KEY_ID=AK*******************
AWS_SECRET_ACCESS_KEY=****************************************
</pre></div>
</div>
<p>Then you can use the cloudknot functions
<a class="reference internal" href="api/_autosummary/cloudknot.aws.set_profile.html#cloudknot.aws.set_profile" title="cloudknot.aws.set_profile"><code class="xref py py-func docutils literal"><span class="pre">cloudknot.set_profile</span></code></a>,
<a class="reference internal" href="api/_autosummary/cloudknot.aws.get_profile.html#cloudknot.aws.get_profile" title="cloudknot.aws.get_profile"><code class="xref py py-func docutils literal"><span class="pre">cloudknot.get_profile</span></code></a>, and
<a class="reference internal" href="api/_autosummary/cloudknot.aws.list_profiles.html#cloudknot.aws.list_profiles" title="cloudknot.aws.list_profiles"><code class="xref py py-func docutils literal"><span class="pre">cloudknot.list_profiles</span></code></a>
to interact with your various AWS profiles.</p>
</div>
<div class="section" id="region-shopping">
<span id="region-shopping-label"></span><h2>Region shopping<a class="headerlink" href="#region-shopping" title="Permalink to this headline">¶</a></h2>
<p>You may want to shop the AWS regions for the cheapest spot instance pricing
(see <a class="reference external" href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-spot-instances-history.html">this page</a>
for details). You can view and change the region in which your cloudknot
resources reside and in which you will launch your AWS Batch jobs by using the
<a class="reference internal" href="api/_autosummary/cloudknot.aws.get_region.html#cloudknot.aws.get_region" title="cloudknot.aws.get_region"><code class="xref py py-func docutils literal"><span class="pre">cloudknot.aws.get_region()</span></code></a> and <a class="reference internal" href="api/_autosummary/cloudknot.aws.set_region.html#cloudknot.aws.set_region" title="cloudknot.aws.set_region"><code class="xref py py-func docutils literal"><span class="pre">cloudknot.aws.set_region()</span></code></a> functions.</p>
</div>
<div class="section" id="examples">
<span id="eg-label"></span><h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>See the <a class="reference external" href="https://github.com/richford/cloudknot/tree/master/examples">examples directory</a> on github for
(you guessed it) examples of how to use cloudknot.</p>
</div>
<div class="section" id="cloudknot-s3-bucket">
<h2>Cloudknot S3 Bucket<a class="headerlink" href="#cloudknot-s3-bucket" title="Permalink to this headline">¶</a></h2>
<p>Cloudknot has some methods to return the results of AWS Batch jobs to the
user. See, for example, <a class="reference internal" href="documentation.html#cloudknot.Knot.map" title="cloudknot.Knot.map"><code class="xref py py-func docutils literal"><span class="pre">cloudknot.Knot.map()</span></code></a>,
<a class="reference internal" href="api/_autosummary/cloudknot.aws.BatchJob.html#cloudknot.aws.BatchJob.done" title="cloudknot.aws.BatchJob.done"><code class="xref py py-func docutils literal"><span class="pre">cloudknot.BatchJob.done</span></code></a>, and
<a class="reference internal" href="api/_autosummary/cloudknot.aws.BatchJob.html#cloudknot.aws.BatchJob.result" title="cloudknot.aws.BatchJob.result"><code class="xref py py-func docutils literal"><span class="pre">cloudknot.BatchJob.result</span></code></a>. Under
the hood, these methods pass results through an Amazon S3 bucket. You can get
and set the name of this S3 bucket using
<a class="reference internal" href="api/_autosummary/cloudknot.aws.get_s3_bucket.html#cloudknot.aws.get_s3_bucket" title="cloudknot.aws.get_s3_bucket"><code class="xref py py-func docutils literal"><span class="pre">cloudknot.get_s3_bucket</span></code></a> and
<a class="reference internal" href="api/_autosummary/cloudknot.aws.set_s3_bucket.html#cloudknot.aws.set_s3_bucket" title="cloudknot.aws.set_s3_bucket"><code class="xref py py-func docutils literal"><span class="pre">cloudknot.set_s3_bucket</span></code></a>.</p>
</div>
<div class="section" id="aws-resource-limitations">
<h2>AWS resource limitations<a class="headerlink" href="#aws-resource-limitations" title="Permalink to this headline">¶</a></h2>
<p>AWS places <a class="reference external" href="https://docs.aws.amazon.com/general/latest/gr/aws_service_limits.html">some limits</a>
on the number of services in each region for an AWS account. The most relevant
limits for cloudknot users are the <a class="reference external" href="https://docs.aws.amazon.com/general/latest/gr/aws_service_limits.html#limits_vpc">AWS Virtual Private Cloud (VPC) limits</a>,
which limit the number of VPCs per region to five, and the <a class="reference external" href="https://docs.aws.amazon.com/general/latest/gr/aws_service_limits.html#limits_batch">AWS Batch limits</a>,
which limit the number of compute environments and job queues. For most use
cases, these limits should not be a problem. However, if you are using
cloudknot along with other users in the same organization, you might bump up
against these limitations. To avoid the VPC limit, try always to use the
default VPC or to agree with your coworkers on using an organization-wide
PARS name. To avoid the batch limits, <a class="reference internal" href="documentation.html#clobber-label"><span class="std std-ref">clobber</span></a> old knots
that you are no longer using. If none of those approaches work for you, you can
<a class="reference external" href="https://docs.aws.amazon.com/general/latest/gr/aws_service_limits.html">request increases to some service limits</a>.</p>
<p>If the terms “<a class="reference internal" href="documentation.html#knot-label"><span class="std std-ref">knot</span></a>,” “<a class="reference internal" href="documentation.html#pars-label"><span class="std std-ref">PARS</span></a>,” and
“<a class="reference internal" href="documentation.html#clobber-label"><span class="std std-ref">clobber</span></a>” in the preceding paragraph confound
you, take a look at the <a class="reference internal" href="documentation.html#doc-label"><span class="std std-ref">cloudknot documentation</span></a>.</p>
</div>
<div class="section" id="debugging-and-logging">
<h2>Debugging and logging<a class="headerlink" href="#debugging-and-logging" title="Permalink to this headline">¶</a></h2>
<p>Cloudknot will print logging info to the console by setting the
<cite>CLOUDKNOT_LOGLEVEL</cite> environment variable:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">CLOUDKNOT_LOGLEVEL</span><span class="o">=</span><span class="n">INFO</span>
</pre></div>
</div>
<p>Cloudknot also writes a much more verbose log for the current session in the
user’s home directory in the path returned by</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os.path</span> <span class="kn">as</span> <span class="nn">op</span>
<span class="n">op</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">),</span> <span class="s1">&#39;.cloudknot&#39;</span><span class="p">,</span> <span class="s1">&#39;cloudknot.log&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If something goes wrong with an AWS Batch job, you might want to inspect the
job’s log on Amazon CloudWatch. You can get a URL for each job attempt’s
CloudWatch log using the
<a class="reference internal" href="api/_autosummary/cloudknot.aws.BatchJob.html#cloudknot.aws.BatchJob.log_urls" title="cloudknot.aws.BatchJob.log_urls"><code class="xref py py-func docutils literal"><span class="pre">cloudknot.BatchJob.log_urls</span></code></a>
parameter.</p>
</div>
</div>


          </div>
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    
    <div class="footer">
      &copy;2017, Adam Richie-Halford, Ariel Rokem.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/getting_started.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
    <script type="text/javascript">
        $(document).ready(function() {
            $(".toggle > *").hide();
            $(".toggle .header").show();
            $(".toggle .header").click(function() {
                $(this).parent().children().not(".header").toggle(400);
                $(this).parent().children(".header").toggleClass("open");
            })
        });
    </script>

  </body>
</html>